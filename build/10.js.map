{"version":3,"sources":["../../src/pages/register/register.page.module.ts","../../src/pages/register/register.page.ts"],"names":[],"mappings":"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","file":"10.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { RegisterPage } from './register.page';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    RegisterPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(RegisterPage),\r\n  ]\r\n})\r\nexport class RegisterPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/register/register.page.module.ts","import { Component } from '@angular/core';\r\nimport { Alert, AlertController, IonicPage, Loading, LoadingController, NavController, NavParams } from 'ionic-angular';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\n\r\nimport { AuthService } from '../../providers/auth/auth.service';\r\nimport { BaseService } from '../../providers/base/base.service';\r\nimport { UserService } from '../../providers/user/user.service';\r\n\r\nimport * as firebase from 'firebase/app';\r\nimport { first } from 'rxjs/operators';\r\n\r\n@IonicPage({\r\n  defaultHistory: ['LoginPage']\r\n})\r\n\r\n@Component({\r\n  selector: 'page-register',\r\n  templateUrl: 'register.page.html',\r\n})\r\n\r\nexport class RegisterPage extends BaseService {\r\n\r\n  signupForm: FormGroup;\r\n\r\n  constructor(\r\n    public alertCtrl: AlertController,\r\n    public authService: AuthService,\r\n    public formBuilder: FormBuilder,\r\n    public loadingCtrl: LoadingController,\r\n    public navCtrl: NavController,\r\n    public navParams: NavParams,\r\n    public userService: UserService\r\n  ) {\r\n    super();\r\n    this.signupForm = this.formBuilder.group({\r\n      name: ['', [Validators.required, Validators.minLength(4)]],\r\n      username: ['', Validators.required],\r\n      apt: ['', Validators.required],\r\n      email: ['', Validators.required],\r\n      password: ['', [Validators.required, Validators.minLength(6)]],\r\n      repassword: ['', [Validators.required, Validators.minLength(6)]]\r\n    });\r\n\r\n  }\r\n\r\n  onSubmit(): void {\r\n\r\n    let loading: Loading = this.showLoading(\"Registering...\");\r\n    let formUser = this.signupForm.value;\r\n    let username: string = formUser.username;\r\n\r\n    this.userService.userExists(username)\r\n      .pipe(\r\n        first()\r\n      )\r\n      .subscribe((userExists: boolean) => {\r\n\r\n        if (!userExists) {\r\n          this.authService.createAuthUser({\r\n            email: formUser.email,\r\n            password: formUser.password\r\n          }).then((authUser: firebase.User) => {\r\n\r\n            delete formUser.password;\r\n            delete formUser.repassword;\r\n            formUser.access = 1;\r\n            formUser.voted = false;\r\n            let uuid: string = authUser[\"user\"].uid;\r\n\r\n            this.userService.create(formUser, uuid)\r\n              .then(() => {\r\n                let alert = this.showAlert('Successful', 'You have been registered.');\r\n                alert.onDidDismiss(() => {\r\n                  this.navCtrl.setRoot('TutorialPage');\r\n                  loading.dismiss();\r\n                });\r\n              }).catch((error: any) => {\r\n                loading.dismiss();\r\n                this.showAlert(`Register failed`, error);\r\n              });\r\n          }).catch((error: any) => {\r\n            loading.dismiss();\r\n            this.showAlert(`Register failed`, error);\r\n          });\r\n        } else {\r\n          loading.dismiss();\r\n          this.showAlert(`Register failed`, `The username ${username} is already in use`);\r\n        }\r\n\r\n      });\r\n\r\n  }\r\n\r\n  private showLoading(message): Loading {\r\n    let loading: Loading = this.loadingCtrl.create({\r\n      content: message\r\n    });\r\n\r\n    loading.present();\r\n\r\n    return loading;\r\n  }\r\n\r\n  private showAlert(title: string, message: string): Alert {\r\n    let alert = this.alertCtrl.create({\r\n      title: title,\r\n      subTitle: message,\r\n      buttons: ['Ok']\r\n    });\r\n    \r\n    alert.present();\r\n\r\n    return alert;\r\n  }\r\n\r\n\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/register/register.page.ts"],"sourceRoot":""}